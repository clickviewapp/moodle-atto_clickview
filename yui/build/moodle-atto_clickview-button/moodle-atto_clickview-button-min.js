YUI.add("moodle-atto_clickview-button",function(t,e){var r,o,s,a,c,l,i,n,d,u=(r={},o=1,a=s=null,c=function(t){return t&&"function"==typeof t},l=function(t,e){var i,n,o;if(void 0!==t&&c(e))for(i=0;i<t.length;i++)if(n=t[i],void 0!==(o=e.apply(t,[n,i])))return o},i=function(t){var e,i,n;if(!a||a===t.origin){e={};try{e=JSON.parse(t.data)}catch(t){return}i=e.data||{},n=e.type||"",t.source!=s&&(d(n,i,t),d("message",i,t))}},n=function(t,e,i,n){r[t]||(r[t]=[]),c(e)&&(e.guid||(e.guid=o++),l(r[t],function(t){if(t.fn.guid===e.guid)return!0})||r[t].push({fn:e,once:!!i,ctx:n}))},d=function(t,n,o){r&&t&&r[t]&&l(r[t],function(t,e){if(c(t.fn)){var i=[o];t.fn.apply(t.ctx||null,i.concat(n))}t.once&&this.splice(e,1)})},f.prototype={on:function(t,e,i){n(t,e,!1,i)},one:function(t,e,i){n(t,e,!0,i)},off:function(t,e){var i,n;i=t,n=e,r&&i&&r[i]&&(c(n)?(l(r[i],function(t,e){t.fn.guid===n.guid&&this.splice(e,1)}),0===r[i].length&&delete r[i]):delete r[i])},trigger:function(t){var e,i,n,o;e=this._target,i=t,n=Array.prototype.slice.call(arguments,1),o={type:i=i||"",data:n=n},e.postMessage(JSON.stringify(o),a||"*")}},f);function f(t,e){if(s=window,a=e,this._target=t,this._version="1.1.1",this._handlers=r,!this._target)throw new Error("No target specified");if(!this._target.postMessage)throw new Error("Target element is not supported");if(s.addEventListener)s.addEventListener("message",i,!1);else{if(!s.attachEvent)throw new Error("Cannot attach event listener");s.attachEvent("onmessage",i)}return this}t.namespace("M.atto_clickview").Button=t.Base.create("button",t.M.editor_atto.EditorPlugin,[],{initializer:function(t){this._onlineUrl=t.hostlocation,this._iframeUrl=t.iframeurl,this._consumerKey=t.consumerkey,this._schoolId=t.schoolid,this.addButton({callback:this._displayDialog,iconurl:this._onlineUrl+"/Assets/images/icons/cv-logo.png",tags:"iframe",icon:"icon",iconComponent:"atto_clickview"})},_displayDialog:function(){var i,n,t,o,r=this.getDialogue({width:"824px"});r.set("headerContent","ClickView Plugin for Atto"),r.set("bodyContent",'<iframe id="cv-plugin-frame" src="'+this._onlineUrl+this._iframeUrl+"?consumerKey="+this._consumerKey+"&schoolId="+this._schoolId+'" width="800" height="494" frameborder="0"></iframe>').show(),i=this.get("host"),n=this,t=document.getElementById("cv-plugin-frame"),(o=new u(t.contentWindow)).on("cv-lms-addvideo",function(t,e){i.insertContentAtFocusPoint(e.embedHtml),r.hide(),o.off("cv-lms-addvideo"),n.markUpdated()},!0),r.on("visibleChange",function(t){!1===t.newVal&&o.off("cv-lms-addvideo")})}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});